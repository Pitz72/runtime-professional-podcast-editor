# v0.2.0 - Streaming Foundation Implementation

## Overview
This update introduces the foundational components for the "Streaming" audio architecture, designed to solve the memory limitations identified in the Critical Analysis. By streaming audio data from disk (via the FileSystem Access API) instead of loading entire files into RAM, the application will be able to handle podcast episodes of arbitrary length.

## Key Changes

### 1. AudioStreamService (`src/renderer/services/AudioStreamService.ts`)
- **Purpose**: Manages the lifecycle of audio streams and coordinates between the UI, the Web Worker, and the AudioWorklet.
- **Features**:
    - `initFile(file)`: Parses WAV headers to extract metadata (channels, sample rate, data offset) without reading the whole file.
    - `createStreamNode(context, file)`: Creates a custom `AudioWorkletNode` (`stream-audio-processor`) and sets up the data piping mechanism.
    - **Data Piping**: Uses a "pull" mechanism where the Worklet requests data (`NEED_DATA`), and the Service fetches it from the Worker and sends it back.

### 2. Audio Stream Worker (`src/renderer/workers/audio-stream.worker.ts`)
- **Purpose**: Handles file I/O operations off the main thread to prevent UI freezing.
- **Capabilities**:
    - Reads chunks of data from `File` objects using `FileReader`.
    - Parses WAV headers.
    - Transfers `ArrayBuffer`s to the main thread (zero-copy transfer) for performance.

### 3. Stream Processor (`src/renderer/audio/processors/stream-processor.ts`)
- **Purpose**: An `AudioWorkletProcessor` that plays back the streamed audio data.
- **Mechanism**:
    - Implements a **Circular Buffer** to store incoming audio chunks.
    - Reads from the buffer during the `process()` callback to output audio to the speakers.
    - Manages buffer underruns (silence) and requests more data when the buffer gets low.

### 4. Audio Utilities Refactor (`src/renderer/services/audioUtils.ts`)
- **Restoration**: Fixed critical corruption in the file that was causing build errors.
- **Enhancement**: Updated `initAudioWorklet` to load both the `main-processor` (for effects/metering) and the new `stream-processor`.

### 5. TypeScript & Build Configuration
- **Fixes**: Resolved `DedicatedWorkerGlobalScope` type issues in the worker.
- **Environment**: Created `vite-env.d.ts` to properly type Worker imports (`?worker`).

## Next Steps
- **Integration**: The `AudioStreamService` is implemented but not yet hooked into the main `useAudioEngine` hook. The next session will focus on modifying the engine to use this service for large files.
- **Playback Control**: Implementing seek and pause functionality for the streaming nodes.
